#!/bin/sh

cd /opt/bin;
mkdir tmp;
cd ./tmp;
wget https://github.com/$(wget https://github.com/stenzek/duckstation/releases/latest -O - | egrep '/.*/.*/.*AppImage' -o);
cd ..;
mv ./tmp/*AppImage ./duckstation;
chmod a+x /opt/bin/duckstation;

echo "[Desktop Entry]
Type=Application
Name=DuckStation Qt
GenericName=PlayStation 1 Emulator
Comment=Fast-ish PlayStation 1 emulator
Icon=duckstation
Exec=/opt/bin/duckstation %f
Categories=Game;Emulator;Qt;" >> /home/$USER/.local/share/applications/duckstation.desktop;

wget https://raw.githubusercontent.com/ivan-hc/AppMan/main/applications/duckstation/duckstation.svg;
mv ./duckstation.svg /home/$USER/.local/share/icons/;

echo "";
echo " DuckStation QT - PlayStation 1 Emulator is provided by";
echo "        https://github.com/stenzek/duckstation ";
echo "";

rm -R /opt/bin/tmp /opt/bin/duckstation-installer
